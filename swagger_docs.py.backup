#!/usr/bin/env python3
"""
YH APIæµ‹è¯•æ¡†æ¶ - FastAPIæ–‡æ¡£æœåŠ¡å™¨
åŸºäºFastAPIçš„åœ¨çº¿æ–‡æ¡£å’ŒAPIæµ‹è¯•ç•Œé¢
"""

import os
import sys
import json
import yaml
from pathlib import Path
from typing import Dict, Any, List, Optional
import logging
from logging_config import get_logger

# å»¶è¿Ÿå¯¼å…¥é‡å‹åº“ä»¥æé«˜å¯åŠ¨æ€§èƒ½
def _lazy_import_fastapi():
    """å»¶è¿Ÿå¯¼å…¥FastAPIç›¸å…³æ¨¡å—"""
    try:
        from fastapi import FastAPI, HTTPException, Request, Form, File, UploadFile
        from fastapi.responses import HTMLResponse, JSONResponse, FileResponse
        from fastapi.staticfiles import StaticFiles
        from fastapi.templating import Jinja2Templates
        from pydantic import BaseModel
        import uvicorn
        return {
            'FastAPI': FastAPI,
            'HTTPException': HTTPException,
            'Request': Request,
            'Form': Form,
            'File': File,
            'UploadFile': UploadFile,
            'HTMLResponse': HTMLResponse,
            'JSONResponse': JSONResponse,
            'FileResponse': FileResponse,
            'StaticFiles': StaticFiles,
            'Jinja2Templates': Jinja2Templates,
            'BaseModel': BaseModel,
            'uvicorn': uvicorn
        }
    except ImportError as e:
        logger.warning(f"FastAPIç›¸å…³æ¨¡å—å¯¼å…¥å¤±è´¥: {e}")
        return None

# è·å–æ—¥å¿—å™¨
logger = get_logger()

class SwaggerDocsServer:
    """YH APIæµ‹è¯•æ¡†æ¶æ–‡æ¡£æœåŠ¡å™¨"""

    def __init__(self, port: int = 8080, host: str = "127.0.0.1"):
        self.port = port
        self.host = host
        self.app = None
        self.fastapi_modules = None
        self._initialized = False

    def _ensure_initialized(self):
        """ç¡®ä¿FastAPIæ¨¡å—å·²åˆå§‹åŒ–"""
        if not self._initialized:
            self.fastapi_modules = _lazy_import_fastapi()
            if self.fastapi_modules is None:
                raise ImportError("æ— æ³•å¯¼å…¥FastAPIç›¸å…³æ¨¡å—ï¼Œè¯·ç¡®ä¿å·²å®‰è£…FastAPI")

            # åˆ›å»ºFastAPIåº”ç”¨
            FastAPI = self.fastapi_modules['FastAPI']

            # è¯¦ç»†çš„APIæ–‡æ¡£æè¿°
            description = """
# YH APIæµ‹è¯•æ¡†æ¶ - ä¼ä¸šçº§APIæµ‹è¯•è§£å†³æ–¹æ¡ˆ

ğŸ¯ **ä¸“ä¸šçš„APIæ¥å£æµ‹è¯•å·¥å…·** - æ™ºèƒ½ã€é«˜æ•ˆã€ä¼ä¸šçº§

---

## ğŸ“š æ¡†æ¶å®Œæ•´ä½¿ç”¨æŒ‡å—

### ğŸ“‹ 1. æµ‹è¯•ç”¨ä¾‹é…ç½® (YAMLæ ¼å¼)
**å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹é…ç½®ç¤ºä¾‹**

```yaml
# test_config.yaml - å®Œæ•´é…ç½®ç¤ºä¾‹
globals:
  base_url: "https://api.example.com"
  username: "testuser"
  password: "123456"
  timeout: 30

test_cases:
  # ç”¨æˆ·ç™»å½•æµ‹è¯•
  - name: "ç”¨æˆ·ç™»å½•æµ‹è¯•"
    method: "POST"
    url: "${base_url}/login"
    headers:
      Content-Type: "application/json"
      User-Agent: "YH-API-Test/2.0"
    json_data:
      username: "${username}"  # å…¨å±€å˜é‡å¼•ç”¨
      password: "${password}"
    extract:  # å‚æ•°æå–
      token: "$.data.token"           # JSONPathæå–
      user_id: "$.data.user.id"
      session: "Set-Cookie: session=([^;]+)"  # æ­£åˆ™æå–
    assert:   # æ–­è¨€éªŒè¯
      status_code: 200
      response_contains: "success"
      json_path:
        "$.code": 0
        "$.data.token": "not_empty"
      response_time_ms: 3000  # æ€§èƒ½æ–­è¨€

  # è·å–ç”¨æˆ·ä¿¡æ¯æµ‹è¯•
  - name: "è·å–ç”¨æˆ·ä¿¡æ¯"
    method: "GET"
    url: "${base_url}/user/${user_id}"  # ä½¿ç”¨ä¸Šä¸€æ­¥æå–çš„å‚æ•°
    headers:
      Authorization: "Bearer ${token}"
    assert:
      status_code: 200
      json_path:
        "$.data.username": "${username}"
```

### ğŸ”— 2. å‚æ•°å¼•ç”¨ä¸æå–è¯¦è§£

#### å…¨å±€å˜é‡å®šä¹‰
```yaml
globals:
  # åŸºç¡€é…ç½®
  base_url: "https://api.example.com"
  api_version: "v1"
  timeout: 30

  # è®¤è¯ä¿¡æ¯
  username: "testuser"
  password: "123456"
  api_key: "your-api-key"

  # ç¯å¢ƒé…ç½®
  env: "test"
  debug: true
```

#### å‚æ•°å¼•ç”¨è¯­æ³•
```yaml
# ä½¿ç”¨ ${variable_name} è¯­æ³•å¼•ç”¨å˜é‡
test_cases:
  - name: "APIæµ‹è¯•"
    url: "${base_url}/${api_version}/users"  # URLä¸­å¼•ç”¨
    headers:
      Authorization: "Bearer ${api_key}"      # è¯·æ±‚å¤´ä¸­å¼•ç”¨
    json_data:
      username: "${username}"                 # è¯·æ±‚ä½“ä¸­å¼•ç”¨
      env: "${env}"
```

#### å‚æ•°æå–æ–¹æ³•
```yaml
extract:
  # JSONPathæå–ï¼ˆæ¨èï¼‰
  token: "$.data.access_token"              # æå–è®¿é—®ä»¤ç‰Œ
  user_id: "$.data.user.id"                 # æå–ç”¨æˆ·ID
  total_count: "$.pagination.total"         # æå–æ€»æ•°

  # æ­£åˆ™è¡¨è¾¾å¼æå–
  session_id: "sessionId=([^;]+)"           # ä»Cookieæå–ä¼šè¯ID
  csrf_token: 'name="csrf_token" value="([^"]+)"'  # ä»HTMLæå–CSRFä»¤ç‰Œ

  # å“åº”å¤´æå–
  location: "header:Location"               # æå–Locationå¤´
  content_type: "header:Content-Type"       # æå–Content-Typeå¤´
```

### âœ… 3. æ–­è¨€éªŒè¯è¯¦è§£

#### åŸºç¡€æ–­è¨€
```yaml
assert:
  # çŠ¶æ€ç æ–­è¨€
  status_code: 200                    # æœŸæœ›çŠ¶æ€ç ä¸º200
  status_code_in: [200, 201, 202]     # çŠ¶æ€ç åœ¨æŒ‡å®šèŒƒå›´å†…

  # å“åº”å†…å®¹æ–­è¨€
  response_contains: ["success", "data"]      # å“åº”åŒ…å«æŒ‡å®šæ–‡æœ¬
  response_not_contains: ["error", "fail"]    # å“åº”ä¸åŒ…å«æŒ‡å®šæ–‡æœ¬
  response_regex: "user_id.*\\d+"             # å“åº”åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼
```

#### JSONæ–­è¨€
```yaml
assert:
  # JSONè·¯å¾„æ–­è¨€
  json_path:
    "$.code": 0                       # è¿”å›ç ä¸º0
    "$.message": "success"            # æ¶ˆæ¯ä¸ºsuccess
    "$.data.user.name": "not_empty"   # ç”¨æˆ·åä¸ä¸ºç©º
    "$.data.list": "is_list"          # æ•°æ®æ˜¯åˆ—è¡¨ç±»å‹
    "$.data.count": "is_number"       # è®¡æ•°æ˜¯æ•°å­—ç±»å‹

  # JSON SchemaéªŒè¯
  json_schema:
    type: "object"
    properties:
      code: { type: "integer" }
      data: { type: "object" }
    required: ["code", "data"]
```

#### æ€§èƒ½æ–­è¨€
```yaml
assert:
  # å“åº”æ—¶é—´æ–­è¨€
  response_time_ms: 3000              # å“åº”æ—¶é—´å°äº3ç§’
  response_time_range: [100, 5000]    # å“åº”æ—¶é—´åœ¨100ms-5sä¹‹é—´

  # å“åº”å¤§å°æ–­è¨€
  response_size_bytes: 10240          # å“åº”å¤§å°å°äº10KB
  response_size_range: [100, 1048576] # å“åº”å¤§å°åœ¨100B-1MBä¹‹é—´
```

### âš¡ 4. å¹¶å‘æµ‹è¯•é…ç½®

#### åŸºç¡€å¹¶å‘é…ç½®
```yaml
concurrent:
  threads: 10        # å¹¶å‘çº¿ç¨‹æ•°
  duration: 60       # æŒç»­æ—¶é—´(ç§’)
  ramp_up: 10        # å¯åŠ¨æ—¶é—´(ç§’)
  think_time: 1      # æ€è€ƒæ—¶é—´(ç§’)

test_cases:
  - name: "å¹¶å‘ç™»å½•æµ‹è¯•"
    concurrent: true
    repeat: 100      # é‡å¤æ‰§è¡Œæ¬¡æ•°
    method: "POST"
    url: "${base_url}/login"
    json_data:
      username: "user_${thread_id}"  # ä½¿ç”¨çº¿ç¨‹IDåŒºåˆ†ç”¨æˆ·
      password: "123456"
```

#### å‹åŠ›æµ‹è¯•é…ç½®
```yaml
# é˜¶æ¢¯å¼å‹åŠ›æµ‹è¯•
load_test:
  stages:
    - duration: 60    # ç¬¬ä¸€é˜¶æ®µï¼š60ç§’
      threads: 5      # 5ä¸ªå¹¶å‘ç”¨æˆ·
    - duration: 120   # ç¬¬äºŒé˜¶æ®µï¼š120ç§’
      threads: 10     # 10ä¸ªå¹¶å‘ç”¨æˆ·
    - duration: 60    # ç¬¬ä¸‰é˜¶æ®µï¼š60ç§’
      threads: 20     # 20ä¸ªå¹¶å‘ç”¨æˆ·

# å³°å€¼æµ‹è¯•é…ç½®
spike_test:
  normal_load: 5     # æ­£å¸¸è´Ÿè½½
  spike_load: 50     # å³°å€¼è´Ÿè½½
  spike_duration: 30 # å³°å€¼æŒç»­æ—¶é—´
```

### ğŸ“Š 5. æŠ¥å‘Šç”Ÿæˆä¸æ¨é€

#### AllureæŠ¥å‘Šé…ç½®
```yaml
report:
  allure:
    enabled: true
    output_dir: "./reports/allure"     # æŠ¥å‘Šè¾“å‡ºç›®å½•
    auto_open: true                    # è‡ªåŠ¨æ‰“å¼€æŠ¥å‘Š
    clean_history: false               # ä¿ç•™å†å²è®°å½•
    categories:                        # è‡ªå®šä¹‰åˆ†ç±»
      - name: "APIé”™è¯¯"
        matchedStatuses: ["failed"]
        messageRegex: ".*API.*"
      - name: "è¶…æ—¶é”™è¯¯"
        matchedStatuses: ["broken"]
        messageRegex: ".*timeout.*"

    # ç¯å¢ƒä¿¡æ¯
    environment:
      æµ‹è¯•ç¯å¢ƒ: "${env}"
      APIç‰ˆæœ¬: "${api_version}"
      æµ‹è¯•äººå‘˜: "YHå›¢é˜Ÿ"
      æµ‹è¯•æ—¶é—´: "${timestamp}"
```

#### ä¼ä¸šå¾®ä¿¡é€šçŸ¥é…ç½®
```yaml
notification:
  wechat:
    webhook: "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxx"
    enabled: true

    # æˆåŠŸé€šçŸ¥æ¨¡æ¿
    success_template: |
      âœ… **APIæµ‹è¯•å®Œæˆ**
      ğŸ“Š **æµ‹è¯•ç»“æœ**: ${total_tests}ä¸ªç”¨ä¾‹ï¼ŒæˆåŠŸ${success_count}ä¸ª
      ğŸ“ˆ **æˆåŠŸç‡**: ${success_rate}%
      â±ï¸ **æ‰§è¡Œæ—¶é—´**: ${duration}ç§’
      ğŸ”— **æŠ¥å‘Šé“¾æ¥**: ${report_url}

    # å¤±è´¥é€šçŸ¥æ¨¡æ¿
    failure_template: |
      âŒ **APIæµ‹è¯•å¤±è´¥**
      ğŸ“Š **æµ‹è¯•ç»“æœ**: ${total_tests}ä¸ªç”¨ä¾‹ï¼Œå¤±è´¥${failure_count}ä¸ª
      ğŸ“‰ **æˆåŠŸç‡**: ${success_rate}%
      ğŸ” **å¤±è´¥åŸå› **: ${failure_summary}
      ğŸ”— **æŠ¥å‘Šé“¾æ¥**: ${report_url}
```

### ğŸ¤– 6. AIæ™ºèƒ½æµ‹è¯•åŠŸèƒ½

#### AIæµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ
```yaml
ai_config:
  enabled: true
  model: "gpt-3.5-turbo"
  api_key: "${openai_api_key}"

  features:
    # è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
    auto_generate_cases:
      enabled: true
      based_on: "swagger_spec"    # åŸºäºSwaggerè§„èŒƒç”Ÿæˆ
      coverage: "full"            # è¦†ç›–åº¦ï¼šbasic/full/custom

    # æ™ºèƒ½æ–­è¨€ç”Ÿæˆ
    smart_assertions:
      enabled: true
      types: ["status", "schema", "business"]  # æ–­è¨€ç±»å‹

    # æ•°æ®éªŒè¯å»ºè®®
    data_validation:
      enabled: true
      auto_boundary_test: true    # è‡ªåŠ¨è¾¹ç•Œå€¼æµ‹è¯•
      invalid_data_test: true     # æ— æ•ˆæ•°æ®æµ‹è¯•

    # æ€§èƒ½åˆ†æ
    performance_analysis:
      enabled: true
      auto_baseline: true         # è‡ªåŠ¨å»ºç«‹æ€§èƒ½åŸºçº¿
      anomaly_detection: true     # å¼‚å¸¸æ£€æµ‹
```

#### AIè¾…åŠ©è°ƒè¯•
```yaml
ai_debug:
  # é”™è¯¯åˆ†æ
  error_analysis:
    enabled: true
    analyze_logs: true          # åˆ†ææ—¥å¿—
    suggest_solutions: true     # å»ºè®®è§£å†³æ–¹æ¡ˆ

  # æµ‹è¯•ä¼˜åŒ–å»ºè®®
  optimization:
    enabled: true
    suggest_improvements: true  # å»ºè®®æ”¹è¿›
    code_review: true          # ä»£ç å®¡æŸ¥
```

## ğŸ“‹ æ”¯æŒçš„HTTPæ–¹æ³•
- **GET**: è·å–æ•°æ®ï¼Œæ”¯æŒURLå‚æ•°å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²
- **POST**: æäº¤æ•°æ®ï¼Œæ”¯æŒJSONã€è¡¨å•å’Œæ–‡ä»¶ä¸Šä¼ 
- **PUT**: æ›´æ–°æ•°æ®ï¼Œå®Œæ•´èµ„æºæ›¿æ¢
- **DELETE**: åˆ é™¤æ•°æ®ï¼Œæ”¯æŒæ‰¹é‡åˆ é™¤
- **PATCH**: éƒ¨åˆ†æ›´æ–°ï¼Œå¢é‡ä¿®æ”¹
- **HEAD**: è·å–å“åº”å¤´ä¿¡æ¯
- **OPTIONS**: è·å–æ”¯æŒçš„æ–¹æ³•

## ğŸ–¥ï¸ Shellå‘½ä»¤æ¨¡å¼

### åŸºç¡€å‘½ä»¤
```bash
# å¯åŠ¨æ¡†æ¶
python run.py

# å¯åŠ¨Webç•Œé¢
python run.py --web --port 8083

# æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹
python run.py --config test_config.yaml

# ç”Ÿæˆæµ‹è¯•é¡¹ç›®
python run.py --generate-project --output ./my_test_project
```

### é«˜çº§å‘½ä»¤
```bash
# å¹¶å‘æµ‹è¯•
python run.py --config test_config.yaml --concurrent --threads 10

# ç”ŸæˆAllureæŠ¥å‘Š
python run.py --config test_config.yaml --allure --auto-open

# AIè¾…åŠ©æµ‹è¯•
python run.py --config test_config.yaml --ai --auto-generate

# ä¼ä¸šå¾®ä¿¡é€šçŸ¥
python run.py --config test_config.yaml --notify wechat

# å®Œæ•´æµ‹è¯•æµç¨‹
python run.py --config test_config.yaml --concurrent --allure --notify wechat --ai
```

## ğŸ› ï¸ é«˜çº§åŠŸèƒ½ç‰¹æ€§
- ğŸ¤– **AIæ™ºèƒ½æµ‹è¯•**: è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ã€æ–­è¨€å’Œæ•°æ®éªŒè¯
- ğŸ“Š **AllureæŠ¥å‘Š**: ä¸“ä¸šçš„HTMLæµ‹è¯•æŠ¥å‘Šï¼Œæ”¯æŒå†å²è¶‹åŠ¿å’Œè‡ªåŠ¨æ‰“å¼€
- ğŸ”” **ä¼ä¸šå¾®ä¿¡é€šçŸ¥**: æµ‹è¯•ç»“æœå®æ—¶æ¨é€åˆ°ä¼ä¸šå¾®ä¿¡ç¾¤ï¼Œæ”¯æŒè‡ªå®šä¹‰æ¨¡æ¿
- âš¡ **å¹¶å‘æµ‹è¯•**: å¤šçº¿ç¨‹æ€§èƒ½æµ‹è¯•ï¼Œæ”¯æŒå‹åŠ›æµ‹è¯•å’Œè´Ÿè½½æµ‹è¯•
- ğŸ› ï¸ **Shellæ¥å£**: å®Œæ•´çš„å‘½ä»¤è¡Œç•Œé¢ï¼Œæ”¯æŒä¸€é”®å¯åŠ¨å’ŒCI/CDé›†æˆ
- ğŸ”— **å‚æ•°å…³è”**: ä¸Šä¸‹æ–‡å‚æ•°ä¼ é€’ï¼Œæ”¯æŒå¤æ‚ä¸šåŠ¡æµç¨‹æµ‹è¯•
- ğŸ“ **æ•°æ®é©±åŠ¨**: YAMLé…ç½®æ–‡ä»¶ï¼Œæ”¯æŒå‚æ•°åŒ–å’Œæ¨¡æ¿åŒ–æµ‹è¯•
- ğŸ” **å®æ—¶ç›‘æ§**: æµ‹è¯•æ‰§è¡ŒçŠ¶æ€å®æ—¶ç›‘æ§å’Œè¯¦ç»†æ—¥å¿—è®°å½•
- ğŸŒ **å¤šåè®®æ”¯æŒ**: HTTP/HTTPSã€WebSocketã€è‡ªå®šä¹‰åè®®
- ğŸ“± **Webç•Œé¢**: ç¾è§‚çš„Webç®¡ç†ç•Œé¢ï¼Œæ”¯æŒåœ¨çº¿æµ‹è¯•å’Œæ–‡æ¡£æŸ¥çœ‹

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

### æµ‹è¯•ç­–ç•¥
- **ç¯å¢ƒéš”ç¦»**: ä¸ºä¸åŒç¯å¢ƒé…ç½®ç‹¬ç«‹çš„æµ‹è¯•ç”¨ä¾‹
- **å‚æ•°åŒ–æµ‹è¯•**: ä½¿ç”¨å…¨å±€å˜é‡å’Œå‚æ•°å¼•ç”¨æé«˜ç”¨ä¾‹å¤ç”¨æ€§
- **æ–­è¨€ç­–ç•¥**: ç»“åˆçŠ¶æ€ç ã€å“åº”å†…å®¹å’Œæ€§èƒ½æ–­è¨€ç¡®ä¿å…¨é¢éªŒè¯
- **å¹¶å‘æµ‹è¯•**: æ ¹æ®ç³»ç»Ÿæ‰¿è½½èƒ½åŠ›åˆç†è®¾ç½®å¹¶å‘å‚æ•°
- **æŒç»­é›†æˆ**: é›†æˆåˆ°CI/CDæµæ°´çº¿ï¼Œå®ç°è‡ªåŠ¨åŒ–æµ‹è¯•

### é¡¹ç›®ç»“æ„å»ºè®®
```
my_api_test/
â”œâ”€â”€ configs/          # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ dev.yaml     # å¼€å‘ç¯å¢ƒ
â”‚   â”œâ”€â”€ test.yaml    # æµ‹è¯•ç¯å¢ƒ
â”‚   â””â”€â”€ prod.yaml    # ç”Ÿäº§ç¯å¢ƒ
â”œâ”€â”€ data/            # æµ‹è¯•æ•°æ®ç›®å½•
â”œâ”€â”€ reports/         # æŠ¥å‘Šè¾“å‡ºç›®å½•
â””â”€â”€ run.py          # å¯åŠ¨è„šæœ¬
```

## ğŸ“ æŠ€æœ¯æ”¯æŒä¸è”ç³»æ–¹å¼

### ğŸ†˜ è·å–å¸®åŠ©
- **QQæŠ€æœ¯æ”¯æŒ**: 2677989813
- **GitHubä»“åº“**: https://github.com/YH-API-Test/api-test-framework
- **åœ¨çº¿æ–‡æ¡£**: æœ¬APIæ–‡æ¡£æä¾›å®Œæ•´çš„æ¥å£è¯´æ˜å’Œä½¿ç”¨ç¤ºä¾‹
- **é—®é¢˜åé¦ˆ**: é€šè¿‡GitHub Issuesæäº¤é—®é¢˜å’Œå»ºè®®

### ğŸ¯ å¿«é€Ÿä½“éªŒ
```bash
# 1åˆ†é’Ÿå¿«é€Ÿå¼€å§‹
git clone https://github.com/YH-API-Test/api-test-framework.git
pip install -r requirements.txt
python run.py --web
# è®¿é—® http://localhost:8083 å¼€å§‹æµ‹è¯•

# 5åˆ†é’Ÿå®Œæ•´ä½“éªŒ
python run.py --generate-project --output ./demo_test
cd demo_test
python run.py --config demo.yaml --concurrent --allure --ai
```

---

**ğŸš€ YH APIæµ‹è¯•æ¡†æ¶ - è®©APIæµ‹è¯•æ›´ç®€å•ã€æ›´æ™ºèƒ½ã€æ›´é«˜æ•ˆï¼**

*ä¸“ä¸šçš„ä¼ä¸šçº§APIæµ‹è¯•è§£å†³æ–¹æ¡ˆï¼ŒåŠ©åŠ›å›¢é˜Ÿæå‡æµ‹è¯•æ•ˆç‡å’Œè´¨é‡*
            """

            self.app = FastAPI(
                title="YH APIæµ‹è¯•æ¡†æ¶",
                description=description,
                version="2.0.0",
                docs_url=None,  # ç¦ç”¨é»˜è®¤æ–‡æ¡£é¡µé¢
                redoc_url=None,  # ç¦ç”¨é»˜è®¤ReDocé¡µé¢
                contact={
                    "name": "YHå›¢é˜Ÿ",
                    "email": "support@yh-api.com",
                },
                license_info={
                    "name": "MIT License",
                    "url": "https://opensource.org/licenses/MIT",
                },
                servers=[
                    {
                        "url": f"http://{self.host}:{self.port}",
                        "description": "YH APIæµ‹è¯•æ¡†æ¶æœåŠ¡å™¨"
                    }
                ]
            )

            # å¼ºåˆ¶è®¾ç½®OpenAPIç‰ˆæœ¬ä¸º3.0.2ä»¥ç¡®ä¿Swagger UIå…¼å®¹æ€§
            def custom_openapi():
                if self.app.openapi_schema:
                    return self.app.openapi_schema

                from fastapi.openapi.utils import get_openapi
                openapi_schema = get_openapi(
                    title=self.app.title,
                    version=self.app.version,
                    description=self.app.description,
                    routes=self.app.routes,
                    servers=self.app.servers,
                )
                # å¼ºåˆ¶è®¾ç½®ä¸ºOpenAPI 3.0.2
                openapi_schema["openapi"] = "3.0.2"
                self.app.openapi_schema = openapi_schema
                return self.app.openapi_schema

            self.app.openapi = custom_openapi

            # æ·»åŠ CORSä¸­é—´ä»¶
            try:
                from fastapi.middleware.cors import CORSMiddleware
                self.app.add_middleware(
                    CORSMiddleware,
                    allow_origins=["*"],
                    allow_credentials=True,
                    allow_methods=["*"],
                    allow_headers=["*"],
                )
            except ImportError:
                logger.warning("æ— æ³•å¯¼å…¥CORSMiddlewareï¼Œè·¨åŸŸè¯·æ±‚å¯èƒ½å¤±è´¥")

            self.setup_routes()
            self._initialized = True
        
    def setup_routes(self):
        """è®¾ç½®è·¯ç”±"""
        if not self.fastapi_modules:
            return

        HTMLResponse = self.fastapi_modules['HTMLResponse']
        JSONResponse = self.fastapi_modules['JSONResponse']
        HTTPException = self.fastapi_modules['HTTPException']
        Request = self.fastapi_modules['Request']
        BaseModel = self.fastapi_modules['BaseModel']

        # å®šä¹‰è¯·æ±‚æ¨¡å‹
        class APITestRequest(BaseModel):
            """APIæµ‹è¯•è¯·æ±‚æ¨¡å‹"""
            method: str
            url: str
            headers: Optional[Dict[str, str]] = {}
            params: Optional[Dict[str, str]] = {}
            json_data: Optional[Dict[str, Any]] = {}
            form_data: Optional[Dict[str, str]] = {}

        @self.app.get("/", response_class=HTMLResponse)
        async def home(request: Request):
            """ä¸»é¡µ"""
            return self.get_home_html()

        @self.app.get("/docs", response_class=HTMLResponse)
        async def custom_swagger_ui_html():
            """è‡ªå®šä¹‰Swagger UIæ–‡æ¡£é¡µé¢"""
            return self.get_custom_docs_html()

        @self.app.get("/redoc", response_class=HTMLResponse)
        async def custom_redoc_html():
            """è‡ªå®šä¹‰ReDocæ–‡æ¡£é¡µé¢"""
            return self.get_custom_redoc_html()






        

        
        @self.app.get(
            "/health",
            summary="ğŸ’š æœåŠ¡å¥åº·æ£€æŸ¥",
            description="""
# æ£€æŸ¥YH APIæµ‹è¯•æ¡†æ¶æœåŠ¡çŠ¶æ€

## ğŸ¯ åŠŸèƒ½è¯´æ˜
æä¾›æœåŠ¡å¥åº·çŠ¶æ€æ£€æŸ¥ï¼Œç”¨äºç›‘æ§å’Œè¿ç»´ç®¡ç†ã€‚

## ğŸ“‹ ä½¿ç”¨åœºæ™¯
- **æœåŠ¡ç›‘æ§**: å®šæœŸæ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
- **è´Ÿè½½å‡è¡¡**: è´Ÿè½½å‡è¡¡å™¨å¥åº·æ£€æŸ¥ç«¯ç‚¹
- **éƒ¨ç½²éªŒè¯**: éƒ¨ç½²åéªŒè¯æœåŠ¡å¯ç”¨æ€§
- **è¿ç»´ç›‘æ§**: é›†æˆåˆ°ç›‘æ§ç³»ç»Ÿä¸­
- **CI/CD**: æŒç»­é›†æˆæµæ°´çº¿ä¸­çš„æœåŠ¡éªŒè¯

## ğŸ“Š å“åº”ç¤ºä¾‹
```json
{
  "status": "healthy",
  "framework": "YH APIæµ‹è¯•æ¡†æ¶",
  "version": "2.0.0",
  "timestamp": "2024-01-01T12:00:00Z",
  "server_info": {
    "host": "127.0.0.1",
    "port": 8083
  }
}
```

## ğŸ” çŠ¶æ€è¯´æ˜
- **healthy**: æœåŠ¡æ­£å¸¸è¿è¡Œï¼Œæ‰€æœ‰åŠŸèƒ½å¯ç”¨
- **degraded**: æœåŠ¡éƒ¨åˆ†åŠŸèƒ½å—é™ï¼Œä½†æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸
- **unhealthy**: æœåŠ¡å¼‚å¸¸ï¼Œéœ€è¦ç«‹å³å¤„ç†

## ğŸ’¡ ä½¿ç”¨å»ºè®®
1. **ç›‘æ§é¢‘ç‡**: å»ºè®®æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
2. **è¶…æ—¶è®¾ç½®**: è®¾ç½®5ç§’è¶…æ—¶æ—¶é—´
3. **å‘Šè­¦ç­–ç•¥**: è¿ç»­3æ¬¡å¤±è´¥æ—¶è§¦å‘å‘Šè­¦

## ğŸ”§ é›†æˆç¤ºä¾‹
```bash
# curlå‘½ä»¤
curl -X GET "http://localhost:8083/health"

# ç›‘æ§è„šæœ¬
#!/bin/bash
RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8083/health)
if [ $RESPONSE -eq 200 ]; then
    echo "Service is healthy"
else
    echo "Service is unhealthy"
fi
```
            """,
            response_description="è¯¦ç»†çš„æœåŠ¡å¥åº·çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…å«ç‰ˆæœ¬å’ŒæœåŠ¡å™¨ä¿¡æ¯",
            tags=["ğŸ”§ ç³»ç»Ÿç›‘æ§"]
        )
        async def health_check():
            """æœåŠ¡å¥åº·æ£€æŸ¥"""
            import datetime

            return {
                "status": "healthy",
                "framework": "YH APIæµ‹è¯•æ¡†æ¶",
                "version": "2.0.0",
                "timestamp": datetime.datetime.now().isoformat(),
                "server_info": {
                    "host": self.host,
                    "port": self.port
                }
            }

    def get_custom_docs_html(self) -> str:
        """è·å–è‡ªå®šä¹‰Swagger UIæ–‡æ¡£é¡µé¢HTML"""
        return """
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YH APIæµ‹è¯•æ¡†æ¶ - APIæ–‡æ¡£</title>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@4.15.5/swagger-ui.css" />
    <style>
        .custom-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .custom-header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .back-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 5px;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }
        .copy-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            transition: all 0.2s ease;
        }
        .copy-btn:hover {
            background: #218838;
        }
        .copy-btn.copied {
            background: #17a2b8;
        }
        .code-block-header {
            position: absolute;
            top: 5px;
            right: 5px;
            opacity: 0.7;
            z-index: 10;
        }
        /* éšè—Swagger UIä¸­çš„ä¸‹è½½URLç›¸å…³å…ƒç´  */
        .download-url-wrapper,
        .download-url-input,
        .download-url-button,
        .servers-wrapper,
        .topbar-wrapper,
        .swagger-ui .topbar,
        .swagger-ui .info .title small,
        .swagger-ui .info .title small pre {
            display: none !important;
        }

        /* éšè—é¡¶éƒ¨æ ä¸­çš„é“¾æ¥ */
        .swagger-ui .topbar .download-url-wrapper {
            display: none !important;
        }

        /* ç¡®ä¿å¤åˆ¶æŒ‰é’®ä¸é‡å¤ */
        .copy-btn {
            position: absolute !important;
            top: 5px !important;
            right: 5px !important;
            z-index: 1000 !important;
        }

        /* éšè—å¯èƒ½æ˜¾ç¤ºopenapi.jsonçš„å…ƒç´  */
        .swagger-ui .info .title small,
        .swagger-ui .info hgroup.main small,
        .swagger-ui .info hgroup.main small pre {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="custom-header">
        <h1>ğŸ“š YH APIæµ‹è¯•æ¡†æ¶ - APIæ–‡æ¡£</h1>
        <a href="/" class="back-btn">â† è¿”å›ä¸»é¡µ</a>
    </div>
    <div id="swagger-ui"></div>

    <script src="https://unpkg.com/swagger-ui-dist@4.15.5/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@4.15.5/swagger-ui-standalone-preset.js"></script>
    <script>
        window.onload = function() {
            const ui = SwaggerUIBundle({
                url: '/openapi.json',
                dom_id: '#swagger-ui',
                deepLinking: true,
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIStandalonePreset
                ],
                plugins: [
                    SwaggerUIBundle.plugins.DownloadUrl
                ],
                layout: "StandaloneLayout",
                // éšè—æœç´¢æ¡†ä¸­çš„/openapi.json
                filter: true,
                // è‡ªå®šä¹‰é…ç½®
                configUrl: null,
                // éšè—é¡¶éƒ¨æ 
                displayOperationId: false,
                displayRequestDuration: true,
                // å®Œå…¨éšè—é¡¶éƒ¨æ 
                layout: "BaseLayout",
                // è‡ªå®šä¹‰æ ·å¼
                onComplete: function() {
                    // éšè—æ‰€æœ‰å¯èƒ½æ˜¾ç¤ºopenapi.jsonçš„å…ƒç´ 
                    const elementsToHide = [
                        '.download-url-input',
                        '.download-url-button',
                        '.download-url-wrapper',
                        '.topbar-wrapper',
                        '.swagger-ui .topbar',
                        '.swagger-ui .info .title small',
                        '.swagger-ui .info hgroup.main small'
                    ];

                    elementsToHide.forEach(selector => {
                        const elements = document.querySelectorAll(selector);
                        elements.forEach(el => {
                            if (el) el.style.display = 'none';
                        });
                    });

                    // ç§»é™¤å¯èƒ½åŒ…å«openapi.jsonæ–‡æœ¬çš„å…ƒç´ 
                    const textElements = document.querySelectorAll('*');
                    textElements.forEach(el => {
                        if (el.textContent && el.textContent.includes('/openapi.json')) {
                            el.style.display = 'none';
                        }
                    });
                }
            });

            // æ·»åŠ ä¸€é”®å¤åˆ¶åŠŸèƒ½ - åªæ‰§è¡Œä¸€æ¬¡
            setTimeout(function() {
                addCopyButtons();
            }, 3000);

            // ç›‘å¬DOMå˜åŒ–ï¼Œä½†é˜²æ­¢é‡å¤æ·»åŠ 
            const observer = new MutationObserver(function(mutations) {
                let shouldAddButtons = false;
                mutations.forEach(function(mutation) {
                    if (mutation.addedNodes.length > 0) {
                        shouldAddButtons = true;
                    }
                });
                if (shouldAddButtons && !document.querySelector('.copy-btn')) {
                    setTimeout(addCopyButtons, 1000);
                }
            });

            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        };

        let copyButtonsAdded = false; // å…¨å±€æ ‡è®°

        function addCopyButtons() {
            // é˜²æ­¢é‡å¤æ‰§è¡Œ
            if (copyButtonsAdded) return;

            const codeBlocks = document.querySelectorAll('.swagger-ui pre code, .swagger-ui pre');
            if (codeBlocks.length === 0) return;

            let buttonsAdded = 0;
            codeBlocks.forEach(function(block, index) {
                // å¤šé‡æ£€æŸ¥ç¡®ä¿ä¸é‡å¤æ·»åŠ 
                if (block.parentElement.querySelector('.copy-btn') ||
                    block.querySelector('.copy-btn') ||
                    block.hasAttribute('data-copy-added')) return;

                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.textContent = 'å¤åˆ¶';
                copyBtn.setAttribute('data-index', index);

                // æ ‡è®°å·²å¤„ç†
                block.setAttribute('data-copy-added', 'true');

                copyBtn.onclick = function() {
                    const text = block.textContent || block.innerText;
                    navigator.clipboard.writeText(text).then(function() {
                        copyBtn.textContent = 'å·²å¤åˆ¶';
                        copyBtn.classList.add('copied');
                        setTimeout(function() {
                            copyBtn.textContent = 'å¤åˆ¶';
                            copyBtn.classList.remove('copied');
                        }, 2000);
                    }).catch(function() {
                        const textArea = document.createElement('textarea');
                        textArea.value = text;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        copyBtn.textContent = 'å·²å¤åˆ¶';
                        copyBtn.classList.add('copied');
                        setTimeout(function() {
                            copyBtn.textContent = 'å¤åˆ¶';
                            copyBtn.classList.remove('copied');
                        }, 2000);
                    });
                };

                const header = document.createElement('div');
                header.className = 'code-block-header';
                header.appendChild(copyBtn);

                if (block.parentElement.tagName === 'PRE') {
                    block.parentElement.style.position = 'relative';
                    block.parentElement.appendChild(header);
                } else {
                    block.style.position = 'relative';
                    block.appendChild(header);
                }

                buttonsAdded++;
            });

            // æ ‡è®°å·²å®Œæˆ
            if (buttonsAdded > 0) {
                copyButtonsAdded = true;
                console.log('å¤åˆ¶æŒ‰é’®æ·»åŠ å®Œæˆï¼Œå…±æ·»åŠ :', buttonsAdded);
            }
        }
    </script>
</body>
</html>
        """

    def get_custom_redoc_html(self) -> str:
        """è·å–è‡ªå®šä¹‰ReDocæ–‡æ¡£é¡µé¢HTML"""
        return """
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YH APIæµ‹è¯•æ¡†æ¶ - APIæ–‡æ¡£ (ReDoc)</title>
    <style>
        body { margin: 0; padding: 0; }
        .custom-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            position: relative;
        }
        .custom-header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .back-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 5px;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }
        #redoc-container {
            height: calc(100vh - 70px);
        }
    </style>
</head>
<body>
    <div class="custom-header">
        <h1>ğŸ“š YH APIæµ‹è¯•æ¡†æ¶ - APIæ–‡æ¡£ (ReDoc)</h1>
        <a href="/" class="back-btn">â† è¿”å›ä¸»é¡µ</a>
    </div>
    <div id="redoc-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/redoc@2.0.0/bundles/redoc.standalone.js"></script>
    <script>
        Redoc.init('/openapi.json', {
            scrollYOffset: 70,
            theme: {
                colors: {
                    primary: {
                        main: '#667eea'
                    }
                }
            }
        }, document.getElementById('redoc-container'));
    </script>
</body>
</html>
        """

    def get_home_html(self) -> str:
        """è·å–ä¸»é¡µHTML"""
        return """
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YH APIæµ‹è¯•æ¡†æ¶ - åœ¨çº¿æ–‡æ¡£</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; color: white; margin-bottom: 40px; }
        .header h1 { font-size: 3em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .card { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); transition: transform 0.3s ease; }
        .card:hover { transform: translateY(-5px); }
        .card h3 { color: #333; margin-bottom: 15px; font-size: 1.5em; }
        .card p { color: #666; line-height: 1.6; margin-bottom: 20px; }
        .btn { display: inline-block; padding: 12px 24px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; text-decoration: none; border-radius: 25px; transition: all 0.3s ease; }
        .btn:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .features { background: white; border-radius: 15px; padding: 30px; margin-bottom: 20px; }
        .features h2 { color: #333; margin-bottom: 20px; text-align: center; }
        .feature-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .feature-item { padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #667eea; }
        .footer { text-align: center; color: white; opacity: 0.8; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ YH APIæµ‹è¯•æ¡†æ¶</h1>
            <p>ä¸“ä¸šçš„APIæ¥å£æµ‹è¯•å·¥å…· - æ™ºèƒ½ã€é«˜æ•ˆã€ä¼ä¸šçº§</p>
        </div>
        
        <div class="cards">
            <div class="card">
                <h3>ğŸ“– æ¡†æ¶ä½¿ç”¨è¯´æ˜</h3>
                <p><strong>å¿«é€Ÿä¸Šæ‰‹YH APIæµ‹è¯•æ¡†æ¶</strong> - æ”¯æŒæµ‹è¯•ç”¨ä¾‹é…ç½®ã€å‚æ•°å¼•ç”¨ã€å‚æ•°æå–ã€æ–­è¨€éªŒè¯ã€æŠ¥å‘Šç”Ÿæˆã€å¹¶å‘æµ‹è¯•ã€AIæ™ºèƒ½æµ‹è¯•ç­‰ä¼ä¸šçº§åŠŸèƒ½ã€‚</p>

                <div style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 14px; line-height: 1.6;">
                    <strong>ğŸš€ æ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨ç¤ºä¾‹ï¼š</strong><br>
                    â€¢ <strong>æµ‹è¯•ç”¨ä¾‹é…ç½®</strong>ï¼šYAMLæ ¼å¼é…ç½®ï¼Œæ”¯æŒå¤šåœºæ™¯æµ‹è¯•<br>
                    â€¢ <strong>å‚æ•°å¼•ç”¨</strong>ï¼š${variable} è¯­æ³•å¼•ç”¨å…¨å±€å˜é‡<br>
                    â€¢ <strong>å‚æ•°æå–</strong>ï¼šJSONPath/æ­£åˆ™æå–å“åº”æ•°æ®<br>
                    â€¢ <strong>æ–­è¨€éªŒè¯</strong>ï¼šçŠ¶æ€ç ã€å“åº”å†…å®¹ã€æ€§èƒ½æ–­è¨€<br>
                    â€¢ <strong>å‘é€æŠ¥å‘Š</strong>ï¼šä¼ä¸šå¾®ä¿¡/é‚®ä»¶è‡ªåŠ¨æ¨é€æµ‹è¯•æŠ¥å‘Š<br>
                    â€¢ <strong>å¹¶å‘æµ‹è¯•</strong>ï¼šå¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œæ€§èƒ½å‹æµ‹<br>
                    â€¢ <strong>AIæ™ºèƒ½æµ‹è¯•</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹å’ŒéªŒè¯é€»è¾‘
                </div>

                <a href="/docs" class="btn">æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£</a>
                <a href="https://github.com/YH-API-Test/api-test-framework" class="btn" target="_blank">GitHubç¤ºä¾‹</a>
            </div>


        </div>
        
        <div class="features">
            <h2>ğŸŒŸ æ ¸å¿ƒç‰¹æ€§</h2>
            <div class="feature-list">
                <div class="feature-item">
                    <strong>ğŸ¯ æ™ºèƒ½æµ‹è¯•</strong><br>
                    AIé©±åŠ¨çš„æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå’ŒéªŒè¯
                </div>
                <div class="feature-item">
                    <strong>ğŸš€ é«˜æ€§èƒ½</strong><br>
                    å¹¶å‘æ‰§è¡Œï¼Œè¿æ¥æ± ä¼˜åŒ–
                </div>
                <div class="feature-item">
                    <strong>ğŸ“Š ä¸°å¯ŒæŠ¥å‘Š</strong><br>
                    AllureæŠ¥å‘Šï¼Œå®æ—¶ç›‘æ§
                </div>
                <div class="feature-item">
                    <strong>ğŸ”§ çµæ´»é…ç½®</strong><br>
                    YAMLé…ç½®ï¼Œç¯å¢ƒç®¡ç†
                </div>
                <div class="feature-item">
                    <strong>ğŸ“± é€šçŸ¥é›†æˆ</strong><br>
                    ä¼ä¸šå¾®ä¿¡ï¼Œé‚®ä»¶é€šçŸ¥
                </div>
                <div class="feature-item">
                    <strong>ğŸŒ å¤šåè®®æ”¯æŒ</strong><br>
                    HTTP/HTTPSï¼ŒWebSocketï¼ŒSocket
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Â© 2025 YH APIæµ‹è¯•æ¡†æ¶ | æŒç»­æ”¹è¿›ï¼Œè¿½æ±‚å“è¶Šï¼</p>
            <p>è”ç³»QQ: 2677989813</p>
        </div>
    </div>
</body>
</html>
        """

    def run(self):
        """å¯åŠ¨æœåŠ¡å™¨"""
        self._ensure_initialized()
        if not self.fastapi_modules:
            raise ImportError("æ— æ³•å¯åŠ¨æœåŠ¡å™¨ï¼ŒFastAPIæ¨¡å—å¯¼å…¥å¤±è´¥")

        uvicorn = self.fastapi_modules['uvicorn']
        print(f"å¯åŠ¨YH APIæµ‹è¯•æ¡†æ¶æ–‡æ¡£æœåŠ¡å™¨: http://{self.host}:{self.port}")
        logger.info(f"å¯åŠ¨YH APIæµ‹è¯•æ¡†æ¶æ–‡æ¡£æœåŠ¡å™¨: http://{self.host}:{self.port}")

        # éªŒè¯OpenAPIè§„èŒƒ
        try:
            openapi_spec = self.app.openapi()
            print(f"OpenAPIç‰ˆæœ¬: {openapi_spec.get('openapi', 'NOT SET')}")
            logger.info(f"OpenAPIç‰ˆæœ¬: {openapi_spec.get('openapi', 'NOT SET')}")
        except Exception as e:
            print(f"OpenAPIè§„èŒƒç”Ÿæˆå¤±è´¥: {e}")
            logger.error(f"OpenAPIè§„èŒƒç”Ÿæˆå¤±è´¥: {e}")

        uvicorn.run(self.app, host=self.host, port=self.port, log_level="info")

def main():
    """ä¸»å‡½æ•°"""
    import argparse
    
    parser = argparse.ArgumentParser(description="YH APIæµ‹è¯•æ¡†æ¶æ–‡æ¡£æœåŠ¡å™¨")
    parser.add_argument("--port", type=int, default=8080, help="æœåŠ¡å™¨ç«¯å£")
    parser.add_argument("--host", type=str, default="127.0.0.1", help="æœåŠ¡å™¨åœ°å€")
    
    args = parser.parse_args()
    
    server = SwaggerDocsServer(port=args.port, host=args.host)
    server.run()

if __name__ == "__main__":
    main()






